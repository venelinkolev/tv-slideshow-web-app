<!-- TV-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–∞–Ω slideshow –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ø—ä–ª–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç -->
<div class="slideshow-container" [class.tv-device]="isTvDevice()"
    [class.safe-area-enabled]="safeAreaEnabled() && !isFullscreenTemplate()"
    [class.fullscreen-template]="isFullscreenTemplate()"
    [class.low-performance]="performanceLevel() != null && performanceLevel() <= 1"
    [class.basic-performance]="performanceLevel() != null && performanceLevel() === 2"
    [class.standard-performance]="performanceLevel() != null && performanceLevel() >= 3" [ngStyle]="safeAreaStyles()">

    <!-- Loading State —Å TV-–ø–æ–¥—Ö–æ–¥—è—â –¥–∏–∑–∞–π–Ω -->
    <app-loading-state [isVisible]="isLoading()" [loadingText]="loadingMessage()"
        [showProgress]="shouldShowLoadingProgress()" [progressValue]="loadingProgress()"
        [performanceLevel]="performanceLevel()" [enableDetailedMessages]="enableDetailedLoadingMessages()">
    </app-loading-state>

    <!-- ERROR STATE COMPONENT -->
    @if (hasError()) {
    <app-error-state [hasError]="hasError()" [errorMessage]="errorMessage()" [errorCode]="errorCode()"
        [errorType]="errorType()" [originalError]="originalError()" [canRetry]="canRetryError()"
        [isRetrying]="isRetrying()" [showDetails]="false" [autoHideDelay]="0" (retry)="onErrorRetry()"
        (dismiss)="onErrorDismiss()" (reportError)="onErrorReport($event)"
        (toggleDetails)="onErrorDetailsToggle($event)">
    </app-error-state>
    }

    <!-- Main Slideshow Content -->
    @if (!isLoading() && !hasError() && products() && products().length > 0) {
    <div class="slideshow-content">
        <!-- EMBLA CAROUSEL INTEGRATION - MAIN SLIDESHOW -->
        <div class="embla-carousel-wrapper" [class.tv-optimized]="isTvDevice()"
            [class.low-performance]="performanceLevel() != null && performanceLevel() <= 2">

            <div class="embla" emblaCarousel [options]="emblaOptions()" #emblaRef="emblaCarousel" role="region"
                [attr.aria-label]="'–ü—Ä–æ–¥—É–∫—Ç–æ–≤ —Å–ª–∞–π–¥—à–æ—É —Å ' + products().length + ' —Å–ª–∞–π–¥–∞'"
                [attr.aria-live]="isAutoPlaying() ? 'polite' : 'off'">

                <div class="embla__container">
                    @for (product of products(); track product.id; let i = $index) {
                    <div class="embla__slide" [class.embla__slide--active]="i === currentSlideIndex()"
                        [attr.aria-hidden]="i !== currentSlideIndex()">

                        <app-template-loader [product]="product"
                            [templateName]="config()?.templates?.selectedTemplateId || 'classic'"
                            [imageQuality]="config()?.tvOptimizations?.performance?.imagePreloading === 'all' ? 'high' : 'medium'"
                            [enableAnimations]="config()?.timing?.transitionType !== 'none'" [forceReload]="false"
                            [class.active-slide]="i === currentSlideIndex()" (templateLoaded)="onTemplateLoaded($event)"
                            (templateError)="onTemplateError($event)" (componentReady)="onComponentReady($event)" />

                    </div>
                    }
                </div>
            </div>


        </div>

        <!-- Slide Progress Indicator -->
        @if (config(); as currentConfig) {
        <app-slide-progress [currentIndex]="currentSlideIndex()" [totalSlides]="products().length"
            [slideInterval]="effectiveSlideInterval()" [showCounter]="true" [showProgressBar]="true" [autoHide]="false"
            [animationEnabled]="currentConfig?.timing?.transitionType !== 'none'"
            (progressComplete)="handleProgressComplete($event)" (progressClick)="handleProgressClick($event)"
            [isCarouselReady]="!!emblaCarousel()" [carouselTransitionDuration]="transitionDuration()"
            [isCarouselTransitioning]="isTransitioning()" [autoPlayActive]="isAutoPlaying()"
            [currentTemplate]="currentTemplate()" [hasError]="hasError()" [errorMessage]="errorMessage()"
            (slideChangeRequested)="onSlideChangeRequested($event)" (pauseRequested)="onPauseAutoRotation()"
            (resumeRequested)="onResumeAutoRotation()" />
        }

        <!-- Navigation Controls (—Å–∫—Ä–∏—Ç–∏ –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ, –ø–æ–∫–∞–∑–≤–∞—Ç —Å–µ –ø—Ä–∏ remote control) -->
        <app-navigation-controls [isAutoPlaying]="isAutoPlaying()" [remoteControlEnabled]="remoteControlEnabled()"
            [hasProducts]="hasProducts()" [productsCount]="products().length" [showHelp]="false" [autoHideDelay]="5000"
            (nextSlide)="nextSlide()" (previousSlide)="previousSlide()" (toggleAutoPlay)="toggleAutoPlay()"
            (requestFullscreen)="requestFullscreen()" (helpToggle)="onHelpToggle($event)"
            [currentSlideIndex]="currentSlideIndex()" [totalSlides]="products().length"
            [isCarouselReady]="!!emblaCarousel()" [isLoading]="isLoading()" [hasError]="hasError()"
            (goToSlide)="onGoToSlide($event)" (pauseCarousel)="onPauseAutoRotation()"
            (resumeCarousel)="onResumeAutoRotation()" (templateChangeRequested)="onTemplateChangeRequested($event)">
        </app-navigation-controls>
    </div>

    }
    <!-- Empty State -->
    @if (!isLoading() && !hasError() && (!products() || products().length === 0)) {
    <div class="empty-state">
        <div class="empty-content">
            <div class="empty-icon">üì¶</div>
            <h2 class="empty-title">–ù—è–º–∞ –Ω–∞–ª–∏—á–Ω–∏ –ø—Ä–æ–¥—É–∫—Ç–∏</h2>
            <p class="empty-message">–ú–æ–ª—è, –¥–æ–±–∞–≤–µ—Ç–µ –ø—Ä–æ–¥—É–∫—Ç–∏ –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è—Ç–∞</p>
        </div>
    </div>
    }

    <!-- Performance Monitor (—Å–∞–º–æ –∑–∞ development/debugging) -->
    @if (isTvDevice() && false) {
    <div class="performance-info" [attr.aria-hidden]="true">
        <div class="perf-item">
            <span class="label">FPS:</span>
            <span class="value" [class.warning]="currentFPS() < 25">{{ currentFPS() }}</span>
        </div>
        <div class="perf-item">
            <span class="label">Memory:</span>
            <span class="value" [class.warning]="memoryUsage() > 80">{{ memoryUsage() }}MB</span>
        </div>
        @if (performanceLevel() != null) {
        <div class="perf-item">
            <span class="label">Level:</span>
            <span class="value">{{ getPerformanceLevelName(performanceLevel()) }}</span>
        </div>
        }
        <div class="perf-item">
            <span class="label">Platform:</span>
            <span class="value">{{ tvPlatform() || 'Unknown' }}</span>
        </div>
    </div>
    }

    <!-- TV Status Indicators -->
    @if (isTvDevice()) {
    <div class="tv-status-indicators" [attr.aria-hidden]="true">

        <!-- Sleep Prevention Active -->
        @if (sleepPreventionActive()) {
        <div class="status-indicator sleep-prevention" title="Sleep prevention active">
            üõ°Ô∏è
        </div>
        }

        <!-- Fullscreen Status -->
        @if (isFullscreen()) {
        <div class="status-indicator fullscreen" title="Fullscreen mode">
            ‚õ∂
        </div>
        }

        <!-- Performance Level -->
        @if (performanceLevel()) {
        <div class="status-indicator performance"
            [class]="'perf-' + getPerformanceLevelName(performanceLevel()).toLowerCase()"
            [title]="'Performance level: ' + getPerformanceLevelName(performanceLevel())">
            {{ performanceLevel() >= 3 ? 'üü¢' :
            performanceLevel() === 2 ? 'üü°' : 'üî¥' }}
        </div>
        }
    </div>
    }

    <!-- Accessibility Announcements -->
    <div class="sr-only" role="status" aria-live="polite" aria-atomic="true">
        @if (isLoading()) {
        <span>–ó–∞—Ä–µ–∂–¥–∞–Ω–µ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏</span>
        } @else if (hasError()) {
        <span>–í—ä–∑–Ω–∏–∫–Ω–∞ –≥—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ—Ç–æ</span>
        }@else if (!isLoading() && !hasError() && products() && products().length > 0) {
        <span>–ü–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ {{ products().length }} –ø—Ä–æ–¥—É–∫—Ç–∞</span>
        }
    </div>
</div>